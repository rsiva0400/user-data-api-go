
```markdown
# UserData API

A Go Fiber REST API for managing users with PostgreSQL and SQLC.

- Type-safe SQL queries using **SQLC**
- CRUD operations for users
- Pagination support (`limit` + `offset`)
- Structured logging using Uber Zap
- Automatic table creation on app startup

---

## Project Structure

```

/cmd/server/main.go
/config/
/db/sqlc/       # generated by SQLC
/internal/
├── handler/
├── repository/
├── service/
├── routes/
├── middleware/
├── models/
└── logger/

````

---

## Prerequisites

- [Go 1.21+](https://golang.org/dl/)
- [Docker](https://www.docker.com/get-started) (for Postgres)
- [SQLC](https://sqlc.dev/) installed locally

---

## Running PostgreSQL in Docker

```bash
docker run -d \
  --name userdb \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=1234 \
  -e POSTGRES_DB=mydb \
  -p 5432:5432 \
  postgres:15
````

* Database: `mydb`
* User: `postgres`
* Password: `1234`
* Port: `5432`

Check if Postgres is running:

```bash
docker ps
```

---

## Configure Environment

Create a `.env` file in your project root:

```
DB_DSN=postgres://postgres:1234@localhost:5432/mydb?sslmode=disable
```

---

## Fetch DB URL in Go Config

You can load the `DB_DSN` from environment variables using `os.Getenv` in your `/config/config.go`:

```go
package config

import (
    "fmt"
    "os"
)

func GetDBURL() string {
    dsn := os.Getenv("DB_DSN")
    if dsn == "" {
        panic("DB_DSN environment variable is not set")
    }
    fmt.Println("Connecting to DB:", dsn)
    return dsn
}
```

Then in your database setup:

```go
import (
    "context"
    "github.com/jackc/pgx/v5/pgxpool"
    "userdata-api/config"
)

func SetupDB() *pgxpool.Pool {
    dsn := config.GetDBURL()
    pool, err := pgxpool.New(context.Background(), dsn)
    if err != nil {
        panic(err)
    }
    return pool
}
```

---

## Generate SQLC Code

```bash
sqlc generate
```

* Generates type-safe Go code from your SQL queries in `db/sqlc`.

---

## Run the Go App Locally

```bash
go run ./cmd/server/main.go
```

* The server runs on port `3000` by default.
* Connects to Postgres using `DB_DSN` environment variable.

---

## API Endpoints

| Method | Endpoint            | Description                                   |
| ------ | ------------------- | --------------------------------------------- |
| POST   | `/api/v1/users`     | Create a new user                             |
| GET    | `/api/v1/users`     | Fetch all users (supports `limit` & `offset`) |
| GET    | `/api/v1/users/:id` | Fetch a single user by ID                     |
| PUT    | `/api/v1/users/:id` | Update a user                                 |
| DELETE | `/api/v1/users/:id` | Delete a user                                 |

---

## Example Request

### Create User

```bash
curl -X POST http://localhost:3000/api/v1/users \
-H "Content-Type: application/json" \
-d '{"name": "Sivaram", "dob": "1990-08-08"}'
```

### Fetch All Users (with pagination)

```bash
curl "http://localhost:3000/api/v1/users?limit=10&offset=0"
```

---

## Notes

* SQLC **must be generated** before running the app locally.
* The app **creates tables automatically**; no separate migrations required.
* Logs are printed using **Uber Zap** in structured JSON format.

